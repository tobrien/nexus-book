<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.discursive.com/docbook/xml/4.5/docbookx.dtd">
<chapter id="bundles">
  <title>Artifact Bundles</title>

  <para><indexterm>
      <primary>artifact bundles</primary>
    </indexterm>Artifact bundles are groups of related artifacts which are all
  related by the same groupId, artifactId, and version (GAV) coordinate. They
  are used by projects that wish to upload artifacts to the Maven Central
  repository.</para>

  <para>Bundles must contain the following POM elements:</para>

  <itemizedlist>
    <listitem>
      <para>modelVersion</para>
    </listitem>

    <listitem>
      <para>groupId</para>
    </listitem>

    <listitem>
      <para>artifactId</para>
    </listitem>

    <listitem>
      <para>packaging</para>
    </listitem>

    <listitem>
      <para>name</para>
    </listitem>

    <listitem>
      <para>version</para>
    </listitem>

    <listitem>
      <para>description</para>
    </listitem>

    <listitem>
      <para>url</para>
    </listitem>

    <listitem>
      <para>licenses</para>
    </listitem>

    <listitem>
      <para>scm</para>

      <itemizedlist>
        <listitem>
          <para>url</para>
        </listitem>

        <listitem>
          <para>connection</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </itemizedlist>

  <section>
    <title>Creating an Artifact Bundle from a Maven Project</title>

    <para><indexterm>
        <primary>Apache Maven</primary>

        <secondary>Maven Repository plugin</secondary>
      </indexterm><indexterm>
        <primary>artifact bundles</primary>

        <secondary>creation of</secondary>
      </indexterm>Artifact bundles are created with the Maven Repository
    Plugin. For more information about the Maven Repository plugin, see <ulink
    url="http://maven.apache.org/plugins/maven-repository-plugin/">http://maven.apache.org/plugins/maven-repository-plugin/</ulink>.</para>

    <para><xref linkend="ex-bundles-sample-pom" />, lists a project's POM
    which satisfies all of the constraints that are checked by the Maven
    Repository plugin. The following POM contains, a description and a URL,
    SCM information, and a reference to a license. All of this information is
    required before an artifact bundle can be published to the Maven Central
    repository.</para>

    <example id="ex-bundles-sample-pom">
      <title>Sample POM Containing all Required Bundle Elements</title>

      <programlisting>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/maven-v4_0_0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.sonatype.sample&lt;/groupId&gt;
  &lt;artifactId&gt;sample-project&lt;/artifactId&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;name&gt;sample-project&lt;/name&gt;
  &lt;description&gt;A Sample Project for the Nexus Book&lt;/description&gt;
  &lt;url&gt;http://books.sonatype.com&lt;/url&gt;
  &lt;licenses&gt;
    &lt;license&gt;
      &lt;name&gt;The Apache Software License, Version 2.0&lt;/name&gt;
      &lt;url&gt;http://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
      &lt;distribution&gt;repo&lt;/distribution&gt;
    &lt;/license&gt;
  &lt;/licenses&gt;
  &lt;scm&gt;
    &lt;connection&gt;
      scm:git:git://github.com/sonatype/sample-project.git
    &lt;/connection&gt;
    &lt;url&gt;scm:git:git://github.com/sonatype/sample-project.git&lt;/url&gt;
    &lt;developerConnection&gt;
      scm:git:git://github.com/sonatype-sample-project.git
    &lt;/developerConnection&gt;     
  &lt;/scm&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;3.8.1&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;</programlisting>
    </example>

    <para>To create a bundle from a Maven project, run the
    repository:bundle-create goal. This goal will check the POM to see if it
    complies with the standards for publishing a bundle to a public
    repository, it will then bundle all of the artifacts are generated by a
    particular build. To build a bundle that only contains the standard,
    unclassified artifact from a project, run <command>mvn
    repository:bundle-create</command>. To generate a bundle which contains
    more than one artifact, run <command>mvn javadoc:jar source:jar
    repository:bundle-create</command>.</para>

    <screen>~/examples/sample-project$ <command>mvn javadoc:jar source:jar repository:bundle-create</command>
[INFO] Scanning for projects...
[INFO] Searching repository for plugin with prefix: 'javadoc'.
[INFO] ------------------------------------------------------------------------
[INFO] Building sample-project
[INFO]    task-segment: [javadoc:jar, source:jar, repository:bundle-create]
[INFO] ------------------------------------------------------------------------
[INFO] [javadoc:jar {execution: default-cli}]
Loading source files for package com.sonatype.sample...
Constructing Javadoc information...
Standard Doclet version 1.6.0_15
Building tree for all the packages and classes...
...
[INFO] Preparing source:jar
[INFO] No goals needed for project - skipping
[INFO] [source:jar {execution: default-cli}]
...
-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running com.sonatype.sample.AppTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.03 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] [jar:jar {execution: default-jar}]
[INFO] Building jar: ~/temp/sample-project/target/sample-project-1.0.jar
[INFO] [repository:bundle-create {execution: default-cli}]
[INFO] The following files are marked for inclusion in the repository bundle:

0.) Done
1.) sample-project-1.0.jar
2.) sample-project-1.0-javadoc.jar
3.) sample-project-1.0-sources.jar

Please select the number(s) for any files you wish to exclude, or '0' when \
you're done.  Separate the numbers for multiple files with a comma (',').

Selection: 
<command>0</command>
[INFO] Building jar: ~/temp/sample-project/target/sample-project-1.0-bundle.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 11 seconds
[INFO] Finished at: Sat Oct 10 21:24:23 CDT 2009
[INFO] Final Memory: 36M/110M
[INFO] ------------------------------------------------------------------------</screen>

    <para>Once the bundle has been created, there will be a bundle JAR in the
    <filename>target/</filename> directory. As shown in the following command
    output, the bundle JAR contains: a POM, the project's unclassified
    artifact, the javadoc artifact, and the sources artifact.</para>

    <screen>~/examples/sample-project$ <command>cd target</command>
~/examples/sample-project/target$ <command>jar tvf sample-project-1.0-bundle.jar</command> 
     0 Sat Oct 10 21:24:24 CDT 2009 META-INF/
    98 Sat Oct 10 21:24:22 CDT 2009 META-INF/MANIFEST.MF
  1206 Sat Oct 10 21:23:46 CDT 2009 pom.xml
  2544 Sat Oct 10 21:24:22 CDT 2009 sample-project-1.0.jar
 20779 Sat Oct 10 21:24:18 CDT 2009 sample-project-1.0-javadoc.jar
   891 Sat Oct 10 21:24:18 CDT 2009 sample-project-1.0-sources.jar
</screen>
  </section>

  <section id="bundles-sect-uploading">
    <title>Uploading an Artifact Bundle to Nexus</title>

    <para><indexterm>
        <primary>artifact bundle</primary>

        <secondary>uploading to Nexus</secondary>
      </indexterm><indexterm>
        <primary>artifact bundle plugin</primary>

        <secondary>uploading bundles</secondary>
      </indexterm><indexterm>
        <primary>Nexus plugin</primary>

        <secondary>Artifact Bundle plugin</secondary>
      </indexterm>To upload an artifact bundle to Nexus Professional, select
    Staging Upload from the Enterprise section of the Nexus menu as shown in
    <xref linkend="fig-bundles-upload-link" />.</para>

    <figure id="fig-bundles-upload-link">
      <title>Staging Upload Link</title>

      <mediaobject>
        <imageobject role="web">
          <imagedata fileref="figs/web/bundles-upload-link.png" />
        </imageobject>

        <imageobject role="print">
          <imagedata align="center"
                     fileref="figs/print/bundles-upload-link.pdf" scalefit="0"
                     security="" width="100%" />
        </imageobject>
      </mediaobject>
    </figure>

    <para><indexterm>
        <primary>staging</primary>

        <secondary>artifact bundle upload</secondary>
      </indexterm>Selecting the Staging Upload link will load the Staging
    Upload dialog. Choose Artifact Bundle form the Upload Mode dropdown the
    Staging Upload panel will switch to the form shown in <xref
    linkend="fig-bundles-staging-upload" />. Click on Select Bundle to
    Upload... and then select the JAR that was created with the Maven
    Repository plugin used in the previous sections. Once a bundle is
    selected, click on Upload Bundle.</para>

    <figure id="fig-bundles-staging-upload">
      <title>Uploading an Artifact Bundle</title>

      <mediaobject>
        <imageobject role="web">
          <imagedata fileref="figs/web/bundles-staging-upload.png" />
        </imageobject>

        <imageobject role="print">
          <imagedata align="center"
                     fileref="figs/print/bundles-staging-upload.pdf"
                     scalefit="0" security="" width="100%" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>After uploading the Artifact Bundle, click on the Staging link in
    the Enterprise section of the Nexus menu as shown in <xref
    linkend="fig-bundles-upload-link" />. Click on Staging will load a list of
    all the defined staging profiles. Click on the first default profiles
    named "Release Staging Profile", and you should see that the Staging
    Artifact Upload created and closed a new staging repository as shown in
    <xref linkend="fig-bundles-staged-bundle" />. This repository contains all
    of the artifacts contained in the uploaded bundle. It allows you to
    promote or drop the artifacts contained in a bundle as a single
    unit.</para>

    <figure id="fig-bundles-staged-bundle">
      <title>Staging Repository Created for Artifact Bundle Upload</title>

      <mediaobject>
        <imageobject role="web">
          <imagedata fileref="figs/web/bundles-staged-bundle.png" />
        </imageobject>

        <imageobject role="print">
          <imagedata align="center"
                     fileref="figs/print/bundles-staged-bundle.pdf"
                     scalefit="0" security="" width="100%" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>To promote a staging repository, right click on the closed
    repository shown in <xref linkend="fig-bundles-staged-bundle" />, and
    select "Promote". Once you select promote, Nexus will present the Promote
    Staged Repository dialog shown in <xref
    linkend="fig-bundles-stage-promote" />. Select the repository that you
    want to published the staging repository to, and click on the Promote
    button.</para>

    <figure id="fig-bundles-stage-promote">
      <title>Promoting a Staged Repository</title>

      <mediaobject>
        <imageobject role="web">
          <imagedata fileref="figs/web/bundles-stage-promote.png" />
        </imageobject>

        <imageobject role="print">
          <imagedata align="center"
                     fileref="figs/print/bundles-stage-promote.pdf"
                     scalefit="0" security="" width="100%" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>After promotion, Nexus will then display a confirmation that the
    promotion was completed successfully as shown in <xref
    linkend="fig-bundles-stage-success" />.</para>

    <figure id="fig-bundles-stage-success">
      <title>Confirmation that Staged Repository has been Promoted</title>

      <mediaobject>
        <imageobject role="web">
          <imagedata fileref="figs/web/bundles-stage-success.png" />
        </imageobject>

        <imageobject role="print">
          <imagedata align="center"
                     fileref="figs/print/bundles-stage-success.pdf"
                     scalefit="0" security="" width="100%" />
        </imageobject>
      </mediaobject>
    </figure>
  </section>
</chapter>
